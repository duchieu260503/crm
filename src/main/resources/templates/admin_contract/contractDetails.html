<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorator="layout">
<body>
<section layout:fragment="content" class="flex-1 p-6 md:p-10">

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b pb-4 mb-8">
        <h1 class="text-2xl font-bold flex items-center gap-2 text-gray-700 mb-4 sm:mb-0">
            <i class="fa fa-file-contract text-viettel-red"></i> Chi tiết thông tin hợp đồng
        </h1>
    </div>

    <div class="max-w-5xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg overflow-hidden border-t-4 border-viettel-red">
            <div class="px-6 py-5 bg-gray-50 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-900">Thông tin chi tiết hợp đồng</h3>
            </div>

            <div class="p-6 space-y-4">
                <div th:object="${contract}" class="grid grid-cols-1 sm:grid-cols-2 gap-y-3 gap-x-6">
                    <div>
                        <p class="font-semibold text-gray-700">Đã hợp tác / Đang xúc tiến</p>
                        <div th:switch="${contract.type.name()}">
                            <p th:case="'IN_PROGRESS'" class="text-gray-900">Đang xúc tiến</p>
                            <p th:case="'DONE_DEAL'" class="text-gray-900">Đã hợp tác</p>
                        </div>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-700">Tên Khách hàng:</p>
                        <p th:text="*{client.name}" class="text-gray-900"></p>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-700">Mã Khách hàng:</p>
                        <a class="text-blue-600 hover:underline" th:text="*{client.id}"
                           th:href="@{/client/details/{id}(id=${contract.client.id})}"></a>
                    </div>
                    <div>
                        <p class="font-semibold text-gray-700">Lĩnh vực:</p>
                        <p th:text="*{client.field}" class="text-gray-900"></p>
                    </div>
                </div>

                <!-- Conditional Rendering Based on Contract Type -->
                <!-- ========== IN PROGRESS Section ========== -->
                <div th:if="${contract.type.name() == 'IN_PROGRESS'}" class="border-t pt-4">
                    <h2 class="text-lg font-semibold mb-2">Thông tin hợp đồng đang xúc tiến: </h2>
                    <div th:object="${contract}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <span class="font-semibold text-gray-700">Tgian bắt đầu tiếp xúc: </span>
                            <span th:text="*{client.approachTime}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Tên dự án: </span>
                            <span th:text="*{client.projectName}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Ngân sách dự án: </span>
                            <span th:attr="data-raw=${contract.client.projectBudget}"
                                  class="numberFormat text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Nguồn tiếp cận: </span>
                            <span th:text="*{client.source}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Đánh giá cơ hội hợp tác: </span>
                            <span th:text="*{client.chance}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">SL seats dự kiến/tháng: </span>
                            <span th:text="*{expectedSeatsPerMonth}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Đơn giá dự kiến: </span>
                            <span th:attr="data-raw=${contract.expectedValue}"
                                  class="numberFormat text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Doanh thu dự kiến/tháng: </span>
                            <span th:attr="data-raw=${contract.expectedRevenuePerMonth}"
                                  class="numberFormat text-gray-900"></span>
                        </div>
<!--                        <div>-->
<!--                            <span class="font-semibold text-gray-700">Đơn vị chủ trì HĐ: </span>-->
<!--                            <span th:text="*{implementingUnit}" class="text-gray-900"></span>-->
<!--                        </div>-->
                        <div>
                            <span class="font-semibold text-gray-700">Đầu mối AM: </span>
                            <span th:text="*{amLead}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Đơn vị triển khai tại VCX: </span>
                            <span th:text="*{vcxImplementingUnit}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Thời gian dự kiến triển khai: </span>
                            <span th:text="*{expectedLaunch}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Phân loại HĐ: </span>
                            <span th:text="*{category}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Tình trạng: </span>
                            <span th:class="*{status} == 'Đã ký' ? 'bg-green-100 text-green-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                               (*{status} == 'Đang ký' ? 'bg-yellow-100 text-yellow-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                               (*{status} == 'Hủy' ? 'bg-red-100 text-red-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                'bg-gray-100 text-gray-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full'))"
                                  th:text="*{status}">
                            </span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Tiến độ: </span>
                            <span th:text="*{detailedProgress}" class="text-gray-900"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-gray-700">Khó khăn / Đề xuất: </span>
                            <span th:text="*{difficulties}" class="text-gray-900"></span>
                        </div>

                    </div>
                </div>

                <!-- ========== DONE DEAL Section ========== -->
                <div th:if="${contract.type.name() == 'DONE_DEAL'}" class="border-t pt-4">
                    <h2 class="text-lg font-semibold mb-2">Thông tin hợp đồng đã ký: </h2>
                    <div class="border-t pt-4">
                        <h2 class="text-base font-semibold mb-2">PAKD:</h2>
                        <div th:object="${contract}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">PAKD Số: </span>
                                <span th:text="*{pakdCode}" class="text-gray-900"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Nội dung PAKD: </span>
                                <span th:text="*{pakdContent}" class="text-gray-900"></span>
                            </div>
                        </div>
                    </div>
                    <div class="border-t pt-4">
                        <h3 class="text-base font-semibold mb-2">PHÂN LOẠI:</h3>
                        <div th:object="${contract}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <span class="font-semibold text-gray-700">Tên SPDV: </span>
                                <span th:text="*{product}" class="text-gray-900"></span>
                            </div>
<!--                            <div>-->
<!--                                <span class="font-semibold text-gray-700">Phòng ban chủ trì HĐ: </span>-->
<!--                                <span th:text="*{implementingUnit}" class="text-gray-900"></span>-->
<!--                            </div>-->
                            <div>
                                <span class="font-semibold text-gray-700">Phân loại Hợp đồng: </span>
                                <span th:text="*{category}" class="text-gray-900"></span>
                            </div>
                            <div>
                                <span class="font-semibold text-gray-700">Phân loại Khách hàng: </span>
                                <span th:text="*{client.category}" class="text-gray-900"></span>
                            </div>
                        </div>
                        <div class="border-t pt-4">
                            <h2 class="text-base font-semibold mb-2">THÔNG TIN HỢP ĐỒNG:</h2>
                            <div th:object="${contract}" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <span class="font-semibold text-gray-700">Số hợp đồng: </span>
                                    <span th:text="*{contractCode}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Ngày ký hợp đồng: </span>
                                    <span th:text="*{signedDate}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Thời điểm bắt đầu HĐ: </span>
                                    <span th:text="*{startDate}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Thời gian cung cấp dịch vụ: </span>
                                    <span th:text="*{durationInMonths + ' tháng'}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Thời điểm kết thúc HĐ: </span>
                                    <span th:text="*{endDate}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">KH cuối sử dụng dịch vụ: </span>
                                    <span th:text="*{lastClient}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">AM phụ trách: </span>
                                    <span th:text="*{amLead}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Kênh bán: </span>
                                    <span th:text="*{sellingChannel}" class="text-gray-900"></span>
                                </div>
<!--                                <div>-->
<!--                                    <span class="font-semibold text-gray-700">Tỷ lệ VCX: </span>-->
<!--                                    <span th:text="*{vcxRatio}" class="text-gray-900"></span>-->
<!--                                </div>-->
                                <div>
                                    <span class="font-semibold text-gray-700">Giá trị hợp đồng (ko VAT): </span>
                                    <span th:attr="data-raw=${contract.contractValueNoVat}"
                                          class="numberFormat text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">VAT: </span>
                                    <span th:attr="data-raw=${contract.vat}"
                                          class="numberFormat text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Tổng giá trị hợp đồng: </span>
                                    <span th:attr="data-raw=${contract.totalValue}"
                                          class="numberFormat text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Nền tảng tổng đài cung cấp dịch vụ: </span>
                                    <span th:text="*{servicePlatform}" class="text-gray-900"></span>
                                </div>
                                <div>
                                    <span class="font-semibold text-gray-700">Tình trạng: </span>
                                    <span th:class="*{status} == 'Đã ký' ? 'bg-green-100 text-green-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                                       (*{status} == 'Đang ký' ? 'bg-yellow-100 text-yellow-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                                       (*{status} == 'Hủy' ? 'bg-red-100 text-red-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full' :
                                        'bg-gray-100 text-gray-800 px-2 inline-flex text-xs leading-5 font-semibold rounded-full'))"
                                          th:text="*{status}">
                                    </span>
                                </div>
                            </div>
                            <div class="mt-4">
                                <span class="font-semibold text-gray-700">Tiến độ: </span>
                                <span th:text="${contract.detailedProgress}" class="text-gray-900"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end">
                <a class="bg-viettel-red hover:bg-viettel-red-dark text-white font-bold py-2 px-4 rounded-md inline-flex items-center transition-colors duration-200 shadow-md"
                   th:href="@{/contract/edit/{id}(id=${contract.id})}">
                    <i class="fas fa-edit mr-2"></i> Chỉnh sửa
                </a>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const elements = document.getElementsByClassName('numberFormat');
            for (let el of elements) {
                const raw = parseInt(el.dataset.raw);
                if (!isNaN(raw)) {
                    el.textContent = raw.toLocaleString('en-US') + ' VNĐ';
                } else {
                    el.textContent = 'N/A';
                }
            }
        });
    </script>
</section>
</body>
</html>
